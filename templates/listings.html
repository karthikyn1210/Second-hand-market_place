{% extends "base.html" %}
{% block content %}
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem;">
  <h1 style="font-weight: 800; margin: 0;">üìã All Listings</h1>
  <p style="margin-top: 0.5rem; opacity: 0.9;">Browse all available products across all categories</p>
</div>

<form class="row g-2 mb-4" style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; border: 1px solid #e0e0e0;">
  <div class="col-md-4">
    <input class="form-control" name="q" placeholder="Search..." value="{{ q }}">
  </div>
  <div class="col-md-2">
    <select class="form-select" name="category">
      <option value="">All categories</option>
      {% for c in categories %}
      <option value="{{ c }}" {% if c == category %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <input class="form-control" name="min_price" placeholder="Min price" value="{{ min_price }}">
  </div>
  <div class="col-md-2">
    <input class="form-control" name="max_price" placeholder="Max price" value="{{ max_price }}">
  </div>
  <div class="col-md-2">
    <select class="form-select" name="sort">
      <option value="">Sort by</option>
      <option value="price_asc" {% if sort=='price_asc' %}selected{% endif %}>Price: Low‚ÜíHigh</option>
      <option value="price_desc" {% if sort=='price_desc' %}selected{% endif %}>Price: High‚ÜíLow</option>
    </select>
  </div>
  <div class="col-md-12 mt-3">
    <button class="btn btn-primary" style="background: #667eea; border: none;">üîç Apply Filters</button>
    <a href="{{ url_for('listings') }}" class="btn btn-outline-secondary ms-2">‚Üª Reset</a>
  </div>
</form>

<div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #667eea;">
  <strong>Total Results: {{ products|length }}</strong> products found
</div>

<div class="row g-4">
  {% if products %}
    {% for p in products %}
    <div class="col-md-4 col-lg-3">
      <div class="card shadow-sm border-0" style="border-radius: 12px; overflow: hidden; transition: all 0.3s ease; height: 100%;">
        <div style="position: relative; height: 220px; background: #f0f0f0; overflow: hidden;">
          {% if p.image_path %}
            <img src="/{{ p.image_path | default('https://via.placeholder.com/300') }}" class="card-img-top" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;" alt="{{ p.title }}">
          {% else %}
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #e0e0e0; font-weight: 600; color: #999;">No Image</div>
          {% endif %}
          <span style="position: absolute; top: 10px; left: 10px; background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.75em; font-weight: 600;">{{ p.category }}</span>
        </div>
        <div class="card-body" style="display: flex; flex-direction: column;">
          <h5 class="card-title" style="font-weight: 700; color: #333; margin-bottom: 0.5rem; white-space: normal; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">{{ p.title }}</h5>
          <p style="color: #999; font-size: 0.9em; margin-bottom: 0.5rem;">Seller: {{ p.seller or 'Unknown' }}</p>
          <p style="color: #666; font-size: 0.85em; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{{ p.description }}</p>
          <div style="margin-top: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h4 style="color: #4169e1; font-weight: 800; margin: 0;">‚Çπ{{ "%.0f"|format(p.price) }}</h4>
              <small style="background: #f0f0f0; padding: 0.3rem 0.6rem; border-radius: 4px; color: #666;">ID: {{ p.id }}</small>
            </div>
            <a href="{{ url_for('product_detail', pid=p.id) }}" class="btn btn-sm btn-primary" style="background: #667eea; border: none; border-radius: 8px; width: 100%;">View Details ‚Üí</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 2rem; text-align: center;">
        <h5 style="color: #856404; margin-bottom: 0.5rem;">‚ö†Ô∏è No listings found</h5>
        <p style="color: #856404; margin: 0;">Try adjusting your search filters or <a href="{{ url_for('listings') }}" style="color: #856404; text-decoration: underline;">view all products</a></p>
      </div>
    </div>
  {% endif %}
</div>

<style>
  .card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2) !important;
  }
  
  .card img:hover {
    transform: scale(1.05);
  }
</style>
{% endblock %}
